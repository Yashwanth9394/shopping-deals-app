<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Deals - Best Prices Today</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.8s ease;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group input,
        .filter-group select {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 1s ease;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .deals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            animation: fadeIn 1.2s ease;
        }

        .deal-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-image {
            width: 100%;
            height: 250px;
            object-fit: contain;
            border-radius: 10px;
            background: #f8f9fa;
            margin-bottom: 15px;
            padding: 10px;
        }

        .image-placeholder {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .product-icon {
            font-size: 5rem;
            margin-bottom: 10px;
            animation: iconFloat 3s ease-in-out infinite;
            filter: brightness(0) invert(1);
        }

        .store-icon-small {
            font-size: 2rem;
            opacity: 0.4;
            filter: brightness(0) invert(1);
        }

        @keyframes iconFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .image-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        .deal-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .deal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .deal-header {
            margin-bottom: 15px;
        }

        .product-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .store-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .deal-price {
            font-size: 2rem;
            font-weight: bold;
            color: #e91e63;
        }

        .regular-price {
            font-size: 1.2rem;
            color: #999;
            text-decoration: line-through;
        }

        .discount-badge {
            background: #ff4444;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .coupon-code {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }

        .coupon-label {
            font-size: 0.85rem;
            color: #856404;
            margin-bottom: 5px;
        }

        .code {
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: #856404;
        }

        .deal-link {
            display: block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .deal-link:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .deal-time {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            color: #666;
        }

        .no-results h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: white;
            font-size: 1.5rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .deals-grid {
                grid-template-columns: 1fr;
            }

            .filter-group {
                flex-direction: column;
            }

            .filter-group input,
            .filter-group select {
                width: 100%;
            }
        }

        .highlight-deal {
            border: 2px solid #ffc107;
        }

        .highlight-deal .product-name,
        .highlight-deal .deal-time {
            color: #333;
        }

        .highlight-deal::before {
            background: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõçÔ∏è Shopping Deals</h1>
            <p class="subtitle">Best Prices & Exclusive Offers Updated Daily</p>
        </header>

        <div class="filters">
            <div class="filter-group">
                <input type="text" id="searchBox" class="search-box" placeholder="üîç Search products, stores..." />
                <select id="storeFilter">
                    <option value="">All Stores</option>
                </select>
                <select id="sortBy">
                    <option value="discount">Best Discount</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                </select>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalDeals">0</div>
                <div class="stat-label">Total Deals</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgSavings">0%</div>
                <div class="stat-label">Avg Savings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="maxDiscount">0%</div>
                <div class="stat-label">Max Discount</div>
            </div>
        </div>

        <div id="dealsContainer" class="deals-grid">
            <div class="loading">Loading amazing deals...</div>
        </div>
    </div>

    <script>
        let allDeals = [];

        async function loadDeals() {
            try {
                // Fetch deals from CSV file
                const response = await fetch('deals.csv');
                const csvData = await response.text();

                const lines = csvData.split('\n');

                // Skip first 2 lines (header info and column headers)
                const deals = [];

                for (let i = 2; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Parse CSV properly handling quotes
                    const values = parseCSVLine(line);

                    if (values.length >= 6 && values[0] && values[5]) {
                        const productName = values[0].trim();
                        const storeName = values[1]?.trim() || 'Various';
                        const dealPrice = parseFloat(values[2]?.trim()) || null;
                        const regularPrice = parseFloat(values[3]?.trim()) || null;
                        const couponCode = values[4]?.trim() || '';
                        const link = values[5]?.trim() || '';
                        const startTime = values[6]?.trim() || '';
                        const endTime = values[7]?.trim() || '';

                        // Skip if it's not a valid deal
                        if (productName.includes('Sheet will be updated') ||
                            productName.includes('Amazon prime') ||
                            productName.includes('Beats') ||
                            productName.startsWith('Apple,') ||
                            !link) continue;

                        deals.push({
                            productName,
                            storeName,
                            dealPrice,
                            regularPrice,
                            couponCode,
                            link,
                            startTime,
                            endTime,
                            discount: regularPrice && dealPrice ?
                                Math.round(((regularPrice - dealPrice) / regularPrice) * 100) : 0
                        });
                    }
                }

                allDeals = deals;
                populateStoreFilter();
                updateStats();
                displayDeals(allDeals);
            } catch (error) {
                console.error('Error loading deals:', error);
                document.getElementById('dealsContainer').innerHTML =
                    '<div class="no-results"><h2>Error loading deals</h2><p>Please try again later.</p></div>';
            }
        }

        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current);

            return values;
        }


        function populateStoreFilter() {
            const stores = [...new Set(allDeals.map(d => d.storeName))].sort();
            const storeFilter = document.getElementById('storeFilter');
            stores.forEach(store => {
                const option = document.createElement('option');
                option.value = store;
                option.textContent = store;
                storeFilter.appendChild(option);
            });
        }

        function updateStats() {
            const validDeals = allDeals.filter(d => d.discount > 0);
            document.getElementById('totalDeals').textContent = allDeals.length;
            
            if (validDeals.length > 0) {
                const avgSavings = Math.round(
                    validDeals.reduce((sum, d) => sum + d.discount, 0) / validDeals.length
                );
                const maxDiscount = Math.max(...validDeals.map(d => d.discount));
                
                document.getElementById('avgSavings').textContent = avgSavings + '%';
                document.getElementById('maxDiscount').textContent = maxDiscount + '%';
            }
        }

        // Map stores to icons for better visual appeal
        function getStoreIcon(storeName) {
            const store = storeName.toLowerCase();
            const iconMap = {
                'amazon': 'üì¶',
                'walmart': 'üè™',
                'target': 'üéØ',
                'apple': 'üçé',
                'sony': 'üéÆ',
                'samsung': 'üì±',
                'dyson': 'üí®',
                'shark': 'ü¶à',
                'bose': 'üéß',
                'nike': 'üëü',
                'adidas': '‚öΩ',
                'lego': 'üß±',
                'keurig': '‚òï',
                'ninja': 'ü•∑',
                'jbl': 'üîä',
                'lg': 'üì∫',
                'costco': 'üè¨',
                'various': 'üõçÔ∏è'
            };
            
            for (const [key, icon] of Object.entries(iconMap)) {
                if (store.includes(key)) return icon;
            }
            
            // Default icons based on product category
            return 'üõçÔ∏è';
        }

        function getProductIcon(productName) {
            const product = productName.toLowerCase();
            
            // Category-based icons
            if (product.includes('laptop') || product.includes('macbook')) return 'üíª';
            if (product.includes('phone') || product.includes('iphone') || product.includes('galaxy')) return 'üì±';
            if (product.includes('watch') || product.includes('smartwatch')) return '‚åö';
            if (product.includes('airpods') || product.includes('earbuds') || product.includes('headphone')) return 'üéß';
            if (product.includes('tv') || product.includes('television')) return 'üì∫';
            if (product.includes('vacuum') || product.includes('cleaner')) return 'üßπ';
            if (product.includes('blender') || product.includes('mixer')) return 'üçπ';
            if (product.includes('coffee') || product.includes('espresso')) return '‚òï';
            if (product.includes('air fryer')) return 'üç≥';
            if (product.includes('bike') || product.includes('scooter')) return 'üõ¥';
            if (product.includes('speaker')) return 'üîä';
            if (product.includes('chair') || product.includes('sofa') || product.includes('furniture')) return 'ü™ë';
            if (product.includes('bed') || product.includes('mattress')) return 'üõèÔ∏è';
            if (product.includes('toy') || product.includes('lego')) return 'üß∏';
            if (product.includes('shoe') || product.includes('sneaker')) return 'üëü';
            if (product.includes('shirt') || product.includes('clothing')) return 'üëï';
            if (product.includes('beauty') || product.includes('makeup')) return 'üíÑ';
            if (product.includes('hair dryer') || product.includes('styling')) return 'üíá';
            if (product.includes('gaming') || product.includes('game')) return 'üéÆ';
            if (product.includes('projector')) return 'üìΩÔ∏è';
            if (product.includes('camera')) return 'üì∑';
            
            return 'üéÅ';
        }

        function displayDeals(deals) {
            const container = document.getElementById('dealsContainer');
            
            if (deals.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <h2>No deals found</h2>
                        <p>Try adjusting your filters or search terms.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = deals.map((deal, index) => {
                const isHighlight = deal.productName.toLowerCase().includes('membership') ||
                                   deal.discount > 50;
                
                const productIcon = getProductIcon(deal.productName);
                const storeIcon = getStoreIcon(deal.storeName);

                return `
                    <div class="deal-card ${isHighlight ? 'highlight-deal' : ''}" data-deal-index="${index}">
                        <div class="image-placeholder">
                            <div class="product-icon">${productIcon}</div>
                            <div class="store-icon-small">${storeIcon}</div>
                        </div>
                        <div class="deal-header">
                            <h3 class="product-name">${deal.productName}</h3>
                            <span class="store-badge">${storeIcon} ${deal.storeName}</span>
                        </div>
                        
                        ${deal.dealPrice ? `
                            <div class="price-section">
                                <span class="deal-price">$${deal.dealPrice}</span>
                                ${deal.regularPrice ? `
                                    <span class="regular-price">$${deal.regularPrice}</span>
                                    ${deal.discount > 0 ? `
                                        <span class="discount-badge">${deal.discount}% OFF</span>
                                    ` : ''}
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${deal.couponCode ? `
                            <div class="coupon-code">
                                <div class="coupon-label">Coupon Code:</div>
                                <div class="code">${deal.couponCode}</div>
                            </div>
                        ` : ''}
                        
                        <a href="${deal.link}" target="_blank" class="deal-link">
                            üõí Get This Deal
                        </a>
                        
                        ${deal.startTime || deal.endTime ? `
                            <div class="deal-time">
                                ${deal.startTime ? `Start: ${deal.startTime}` : ''}
                                ${deal.startTime && deal.endTime ? ' | ' : ''}
                                ${deal.endTime ? `End: ${deal.endTime}` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        async function fetchOGImage(url) {
            // Removed unreliable OG image fetching
            // Using category-based icons instead for better performance
            return null;
        }

        async function loadProductImages(deals) {
            // Image loading disabled - using smart icons instead
            // This prevents slow loading, CORS errors, and improves performance
        }

        function filterAndSortDeals() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const storeFilter = document.getElementById('storeFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filtered = allDeals.filter(deal => {
                const matchesSearch = deal.productName.toLowerCase().includes(searchTerm) ||
                                     deal.storeName.toLowerCase().includes(searchTerm);
                const matchesStore = !storeFilter || deal.storeName === storeFilter;
                
                return matchesSearch && matchesStore;
            });
            
            // Sort
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'discount':
                        return b.discount - a.discount;
                    case 'price-low':
                        return (a.dealPrice || 999999) - (b.dealPrice || 999999);
                    case 'price-high':
                        return (b.dealPrice || 0) - (a.dealPrice || 0);
                    default:
                        return 0;
                }
            });
            
            displayDeals(filtered);
        }

        // Event listeners
        document.getElementById('searchBox').addEventListener('input', filterAndSortDeals);
        document.getElementById('storeFilter').addEventListener('change', filterAndSortDeals);
        document.getElementById('sortBy').addEventListener('change', filterAndSortDeals);

        // Load deals on page load
        loadDeals();
    </script>
</body>
</html>
